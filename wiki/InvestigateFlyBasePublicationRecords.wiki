#summary Investigate both the FlyBase db and our RDF db for query precision

= Queries to FlyBase DB =

Release 2009-03, more recent than the data harvested in our RDF DB.

See also:
 * http://imageweb.zoo.ox.ac.uk/wiki/index.php/Flyweb/Gene_Name_Synonyms
 * http://code.google.com/p/openflydata/source/browse/#svn/tags/chado-20090311-FM3-RC2/modules/pub (publication metadata only)
 * http://code.google.com/p/openflydata/source/browse/tags/chado-20090311-FM3-RC2/modules/sequence/flybase/sequence-vanilla-all.d2rq.ttl (linking features with publications)


Access FlyBase Chado database (PostgreSQL)
{{{
hostname: flybase.org
port: 5432
username: flybase
password: (no password)
database name: flybase
}}}

or
{{{
psql -h flybase.org -U flybase flybase
}}}

= Query for Gene FBgn0015799 =
== Search in the feature_pub and pub tables ==

{{{
select feature.uniquename, feature_pub.feature_id, pub.pub_id
from feature_pub, pub, feature
where feature_pub.pub_id = pub.pub_id and feature.feature_id = feature_pub.feature_id and feature.uniquename = 'FBgn0015799'
}}}

162 records were returned. Some of them might be new records added since February.

Query to FlyBase Site Release2009-02 returns 160 records. New references are:
 * http://flybase.org/cgi-bin/fbidq.html?FBrf0202994
 * http://flybase.org/cgi-bin/fbidq.html?FBrf0205083

Query to FlyBase RDF SPARQL endpoint updated in 2009-02 returns 159 records. The missed reference is:
 * http://flybase.org/reports/FBrf0057329.html (flybase:pub_id=>2189960)

Very strange! This record is not in the database for this gene, using the above query! 
This means that, to get all the records for this gene, we might need to query other publication-relevant tables.

== Search in other tables for Gene FBgn0015799 ==
{{{
### search in the featureloc_pub table

select *
from featureloc_pub
where featureloc_pub.pub_id = '2189960'

### 0 rows returned

}}}

{{{
### search in the featuremap_pub table

select *
from featuremap_pub
where featuremap_pub.pub_id = '2189960'

### 0 rows returned

}}}


{{{
### search in the expression_pub table

select *
from expression_pub
where expression_pub.pub_id = '2189960'

### 0 rows returned

}}}


{{{
### search in the featureprop_pub, featureprop, and feature tables

SELECT featureprop.*, featureprop_pub.*, feature.*
  FROM featureprop_pub, featureprop, feature
where featureprop_pub.featureprop_id = featureprop.featureprop_id and feature.feature_id = featureprop.feature_id and featureprop_pub.pub_id='218960'

### 23 rows returned
}}}


The feature property relating to the gene "FBgn0015799" is "polyclonal":

{{{
"featureprop_id";"feature_id";"type_id";"value";"rank";"featureprop_pub_id";"featureprop_id";"pub_id";"feature_id";"dbxref_id";"organism_id";"name";"uniquename";"residues";"seqlen";"md5checksum";"type_id";"is_analysis";"timeaccessioned";"timelastmodified";"is_obsolete"
2288675;3084941;60035;"polyclonal";0;402500;2288675;218960;3084941;58047;1;"Rbf";"FBgn0015799";"";4370;"";219;f;"2003-12-01 16:53:34.014597";"2003-12-01 16:53:34.014597";f

}}}


The "antibody" section in FlyBase section clearly shows how this citation is associated with this Gene, although this is not clearly stated by the "Data from Reference" section in the page http://fb2009_02.flybase.org/reports/FBrf0057329.html.

{{{
### search in the feature_relationship_pub, featurerelationship, and feature tables

select r.*, p.*, f.uniquename, f.feature_id
from feature_relationship as r, feature_relationship_pub as p, feature as f
where r.feature_relationship_id = p.feature_relationship_id and p.pub_id = '218960' and f.feature_id = r.object_id 

### 4 rows returned, but none relates to our gene

select r.*, p.*, f.uniquename, f.feature_id
from feature_relationship as r, feature_relationship_pub as p, feature as f
where r.feature_relationship_id = p.feature_relationship_id and p.pub_id = '218960' and f.feature_id = r.subject_id 

### 4 rows returned, but none relates to our gene
}}}

== Query SPARQL to test whether featureprop is present in the KB ==
By reading the D2R mapping files, it shows that this is not present in the KB.

= Query for other genes ==
|| Gene name || FlyWeb widget || FlyBase site 2009-02 || Missing reference || FlyBase DB 2009-03 ||
|| FBgn0015799 || 159 || 160 || FBrf0057329 (2189960) || 162 (2 updates, 1 unattributed, actually 159), +1 from featureprop_pub ||
|| FBgn0024285 ||22 ||23 || FBrf0204101 (348205) || 22, +1 from feature_relationship ||
|| FBgn0002838 || 34  || 35  || FBrf0105495 (150339) || 34, ||
|| FBgn0027279 ||   ||   ||   || ||
|| FBgn0000577 ||   ||   ||   || ||
|| FBgn0003996 ||   ||3625 || || 3633 ||
{{{

### query for FBgn0024285 in the featureprop_pub, featureprop, and feature tables

SELECT featureprop.*, featureprop_pub.*, feature.*
  FROM featureprop_pub, featureprop, feature
where featureprop_pub.featureprop_id = featureprop.featureprop_id and feature.feature_id = featureprop.feature_id and featureprop_pub.pub_id='218960' and feature.uniquename = 'FBgn0015799'

### 3 rows returned

2288675;3084941;60035;"polyclonal";0;402500;2288675;218960;3084941;58047;1;"Rbf";"FBgn0015799";"";4370;"";219;f;"2003-12-01 16:53:34.014597";"2003-12-01 16:53:34.014597";f

7057887;3084941;100099;"797 (aa); 95 (kD observed)";1;1557151;7057887;218960;3084941;58047;1;"Rbf";"FBgn0015799";"";4370;"";219;f;"2003-12-01 16:53:34.014597";"2003-12-01 16:53:34.014597";f

7060218;3084941;100090;"2.593 (unknown)";1;1559482;7060218;218960;3084941;58047;1;"Rbf";"FBgn0015799";"";4370;"";219;f;"2003-12-01 16:53:34.014597";"2003-12-01 16:53:34.014597";f


}}}

{{{
## query for FBgn0024285 

select r.*, p.*, f.uniquename, f.feature_id, cvterm.*, cv.name
from feature_relationship as r, feature_relationship_pub as p, feature as f, cvterm, cv
where r.feature_relationship_id = p.feature_relationship_id and r.type_id = cvterm.cvterm_id and cvterm.cv_id = cv.cv_id and p.pub_id = '348205' and f.feature_id = r.subject_id and f.uniquename = 'FBgn0024285'

### result
7082425;4553722;11487309;59983;0;"";1547532;7082425;348205;"FBgn0024285";4553722;59983;4;"";1663273;0;0;"associated_with";"relationship type"
}}}